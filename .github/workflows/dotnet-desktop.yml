name: Build and Release eLog & remeLog

on:
  push:
    branches:
      - master

jobs:
  build:
    name: Build & Publish
    runs-on: windows-latest

    env:
      DOTNET_VERSION: '6.0.x'

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Setup .NET SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}

      - name: üì¶ Restore dependencies
        run: dotnet restore src

      - name: üî® –ü—É–±–ª–∏–∫–∞—Ü–∏—è eLog
        run: dotnet publish src/eLog/eLog.csproj -c Release -r win-x64 -o publish/eLog --self-contained false /p:PublishSingleFile=true /p:IncludeNativeLibrariesForSelfExtract=true /p:PublishReadyToRun=false

      - name: üî® –ü—É–±–ª–∏–∫–∞—Ü–∏—è remeLog
        run: dotnet publish src/remeLog/remeLog.csproj -c Release -r win-x64 -o publish/remeLog --self-contained false /p:PublishSingleFile=true /p:IncludeNativeLibrariesForSelfExtract=true /p:PublishReadyToRun=false

      - name: üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤
        run: |
          dir publish\eLog
          dir publish\remeLog

      - name: üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞
        id: create_release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v${{ github.run_number }}
          name: Release v${{ github.run_number }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: üì§ –ó–∞–≥—Ä—É–∑–∫–∞ eLog.exe
        uses: softprops/action-gh-release@v2
        with:
          files: publish/eLog/eLog.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: üì§ –ó–∞–≥—Ä—É–∑–∫–∞ remeLog.exe
        uses: softprops/action-gh-release@v2
        with:
          files: publish/remeLog/remeLog.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
